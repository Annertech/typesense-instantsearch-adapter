{"version":3,"sources":["SearchResponseAdapter.js"],"names":["_interopRequireDefault","require","Object","value","exports","_toConsumableArray2","_defineProperty2","_classCallCheck2","_createClass2","keys","symbols","i","arguments","source","ownKeys","SearchResponseAdapter","key","_this","adaptedResult","adaptedHit","_objectSpread","typesenseHit","_this2","result","matchLevel","matchedWords","highlight","_result$attribute","Array","typesenseFacetCounts","facet","count","hits","nbHits","page","nbPages","Math","hitsPerPage","facets","processingTimeMS","search_time_ms"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SearchResponseAdapter = void 0;\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar SearchResponseAdapter =\n/*#__PURE__*/\nfunction () {\n  function SearchResponseAdapter(typesenseResponse, instantsearchRequest) {\n    (0, _classCallCheck2[\"default\"])(this, SearchResponseAdapter);\n    this.typesenseResponse = typesenseResponse;\n    this.instantsearchRequest = instantsearchRequest;\n  }\n\n  (0, _createClass2[\"default\"])(SearchResponseAdapter, [{\n    key: \"_adaptHits\",\n    value: function _adaptHits(typesenseHits) {\n      var _this = this;\n\n      var adaptedResult = [];\n      adaptedResult = typesenseHits.map(function (typesenseHit) {\n        var adaptedHit = _objectSpread({}, typesenseHit.document);\n\n        adaptedHit.objectID = typesenseHit.document.id;\n        adaptedHit._highlightResult = _this._adaptHighlightResult(typesenseHit); // Todo: Fix Snippets and Highlights\n\n        adaptedHit._snippetResult = adaptedHit._highlightResult;\n        return adaptedHit;\n      });\n      return adaptedResult;\n    }\n  }, {\n    key: \"_adaptHighlightTag\",\n    value: function _adaptHighlightTag(value) {\n      return value.replace(new RegExp(\"<mark>\", \"g\"), this.instantsearchRequest.params.highlightPreTag).replace(new RegExp(\"</mark>\", \"g\"), this.instantsearchRequest.params.highlightPostTag);\n    }\n  }, {\n    key: \"_adaptHighlightResult\",\n    value: function _adaptHighlightResult(typesenseHit) {\n      var _this2 = this;\n\n      // Algolia lists all searchable attributes in this key, even if there are no matches\n      // So do the same and then override highlights\n      var result = Object.assign.apply(Object, [{}].concat((0, _toConsumableArray2[\"default\"])(Object.keys(typesenseHit.document).map(function (attribute) {\n        return (0, _defineProperty2[\"default\"])({}, attribute, {\n          value: typesenseHit.document[attribute],\n          matchLevel: \"none\",\n          matchedWords: []\n        });\n      }))));\n      typesenseHit.highlights.forEach(function (highlight) {\n        result[highlight.field] = {\n          value: highlight.snippet,\n          matchLevel: \"full\",\n          matchedWords: [] // Todo: Fix MatchedWords\n\n        };\n      }); // Now convert any values that have an array value\n      // Also, replace highlight tag\n\n      Object.keys(result).forEach(function (attribute) {\n        var _result$attribute = result[attribute],\n            value = _result$attribute.value,\n            matchLevel = _result$attribute.matchLevel,\n            matchedWords = _result$attribute.matchedWords;\n\n        if (Array.isArray(value)) {\n          result[attribute] = [];\n          value.forEach(function (v) {\n            result[attribute].push({\n              value: _this2._adaptHighlightTag(\"\".concat(v)),\n              matchLevel: matchLevel,\n              // TODO: Fix MatchLevel for array\n              matchedWords: matchedWords // TODO: Fix MatchedWords for array\n\n            });\n          });\n        } else {\n          // Convert all values to strings\n          result[attribute].value = _this2._adaptHighlightTag(\"\".concat(value));\n        }\n      });\n      return result;\n    }\n  }, {\n    key: \"_adaptFacets\",\n    value: function _adaptFacets(typesenseFacetCounts) {\n      var adaptedResult = {};\n      typesenseFacetCounts.forEach(function (facet) {\n        Object.assign(adaptedResult, (0, _defineProperty2[\"default\"])({}, facet.field_name, Object.assign.apply(Object, [{}].concat((0, _toConsumableArray2[\"default\"])(facet.counts.map(function (count) {\n          return (0, _defineProperty2[\"default\"])({}, count.value, count.count);\n        }))))));\n      });\n      return adaptedResult;\n    }\n  }, {\n    key: \"adapt\",\n    value: function adapt() {\n      var adaptedResult = {\n        hits: this._adaptHits(this.typesenseResponse.hits),\n        nbHits: this.typesenseResponse.found,\n        page: this.typesenseResponse.page,\n        nbPages: Math.ceil(this.typesenseResponse.found / this.typesenseResponse.hits.length),\n        hitsPerPage: this.typesenseResponse.hits.length,\n        facets: this._adaptFacets(this.typesenseResponse.facet_counts),\n        processingTimeMS: this.typesenseResponse.search_time_ms\n      };\n      return adaptedResult;\n    }\n  }]);\n  return SearchResponseAdapter;\n}();\n\nexports.SearchResponseAdapter = SearchResponseAdapter;"],"file":"SearchResponseAdapter.js"}