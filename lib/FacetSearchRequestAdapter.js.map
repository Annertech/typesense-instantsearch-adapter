{"version":3,"sources":["FacetSearchRequestAdapter.js"],"names":["_interopRequireDefault","require","Object","value","exports","_regenerator","_asyncToGenerator2","_slicedToArray2","_classCallCheck2","_createClass2","FacetSearchRequestAdapter","console","key","adaptedResult","intermediateFacetFilters","facetFilters","_facetFilter$split","facetFilter","_facetFilter$split2","facetName","facetValue","_request","_context","params","indexName","q","facet_query","query_by","facet_by","filter_by","max_facet_values","page"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FacetSearchRequestAdapter = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar FacetSearchRequestAdapter =\n/*#__PURE__*/\nfunction () {\n  function FacetSearchRequestAdapter(instantsearchRequest, typesenseClient, searchByFields) {\n    (0, _classCallCheck2[\"default\"])(this, FacetSearchRequestAdapter);\n    console.log(instantsearchRequest);\n    this.instantsearchRequest = instantsearchRequest;\n    this.typesenseClient = typesenseClient;\n    this.searchByFields = searchByFields;\n  }\n\n  (0, _createClass2[\"default\"])(FacetSearchRequestAdapter, [{\n    key: \"_adaptFacetFilters\",\n    value: function _adaptFacetFilters(facetFilters) {\n      var adaptedResult = \"\";\n\n      if (!facetFilters) {\n        return adaptedResult;\n      }\n\n      var intermediateFacetFilters = {}; // Need to transform:\n      // faceFilters = [[\"facet1:value1\", \"facet1:value2\"], \"facet2:value3\"]]\n      //\n      // Into this:\n      // intermediateFacetFilters = {\n      //     \"facet1\": [\"value1\", \"value2\"],\n      //     \"facet2\": [\"value1\", \"value2\"]\n      // }\n\n      facetFilters.flat().forEach(function (facetFilter) {\n        var _facetFilter$split = facetFilter.split(\":\"),\n            _facetFilter$split2 = (0, _slicedToArray2[\"default\"])(_facetFilter$split, 2),\n            facetName = _facetFilter$split2[0],\n            facetValue = _facetFilter$split2[1];\n\n        intermediateFacetFilters[facetName] = intermediateFacetFilters[facetName] || [];\n        intermediateFacetFilters[facetName].push(facetValue);\n      }); // Need to transform this:\n      // intermediateFacetFilters = {\n      //     \"facet1\": [\"value1\", \"value2\"],\n      //     \"facet2\": [\"value1\", \"value2\"]\n      // }\n      //\n      // Into this:\n      // facet1: [value1,value2] && facet2: [value1,value2]\n\n      adaptedResult = Object.keys(intermediateFacetFilters).map(function (facet) {\n        return \"\".concat(facet, \": [\").concat(intermediateFacetFilters[facet].join(\",\"), \"]\");\n      }).join(\" && \");\n      return adaptedResult;\n    }\n  }, {\n    key: \"request\",\n    value: function () {\n      var _request = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee() {\n        var params, indexName;\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                params = this.instantsearchRequest.params;\n                indexName = this.instantsearchRequest.indexName;\n                return _context.abrupt(\"return\", this.typesenseClient.collections(indexName).documents().search({\n                  q: params.query === \"\" ? \"*\" : params.query,\n                  facet_query: \"\".concat(params.facetName, \":\").concat(params.facetQuery),\n                  query_by: this.searchByFields.join(\",\"),\n                  facet_by: [params.facets].flat().join(\",\"),\n                  filter_by: this._adaptFacetFilters(params.facetFilters),\n                  max_facet_values: params.maxValuesPerFacet,\n                  page: params.page + 1\n                }));\n\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function request() {\n        return _request.apply(this, arguments);\n      }\n\n      return request;\n    }()\n  }]);\n  return FacetSearchRequestAdapter;\n}();\n\nexports.FacetSearchRequestAdapter = FacetSearchRequestAdapter;"],"file":"FacetSearchRequestAdapter.js"}