{"version":3,"sources":["../src/FacetSearchRequestAdapter.js"],"names":["FacetSearchRequestAdapter","console","facetFilters","adaptedResult","intermediateFacetFilters","facetName","facetValue","facetFilter","params","indexName","q","facet_query","query_by","facet_by","filter_by","max_facet_values","page"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;IAEaA,yB;;;AACX,WAAA,yBAAA,CAAA,oBAAA,EAAA,eAAA,EAAA,cAAA,EAAmE;AAAA,KAAA,GAAA,gBAAA,CAAA,SAAA,CAAA,EAAA,IAAA,EAAA,yBAAA;AACjEC,IAAAA,OAAO,CAAPA,GAAAA,CAAAA,oBAAAA;AACA,SAAA,oBAAA,GAAA,oBAAA;AACA,SAAA,eAAA,GAAA,eAAA;AACA,SAAA,cAAA,GAAA,cAAA;AACD;;;;uCAEkBC,Y,EAAc;AAC/B,UAAIC,aAAa,GAAjB,EAAA;;AAEA,UAAI,CAAJ,YAAA,EAAmB;AACjB,eAAA,aAAA;AACD;;AAED,UAAMC,wBAAwB,GAPC,EAO/B,CAP+B,CAS/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAF,MAAAA,YAAY,CAAZA,IAAAA,GAAAA,OAAAA,CAA4B,UAAA,WAAA,EAAe;AAAA,YAAA,kBAAA,GACTK,WAAW,CAAXA,KAAAA,CADS,GACTA,CADS;AAAA,YAAA,mBAAA,GAAA,CAAA,GAAA,eAAA,CAAA,SAAA,CAAA,EAAA,kBAAA,EAAA,CAAA,CAAA;AAAA,YAClCF,SADkC,GAAA,mBAAA,CAAA,CAAA,CAAA;AAAA,YACvBC,UADuB,GAAA,mBAAA,CAAA,CAAA,CAAA;;AAEzCF,QAAAA,wBAAwB,CAAxBA,SAAwB,CAAxBA,GACEA,wBAAwB,CAAxBA,SAAwB,CAAxBA,IADFA,EAAAA;AAEAA,QAAAA,wBAAwB,CAAxBA,SAAwB,CAAxBA,CAAAA,IAAAA,CAAAA,UAAAA;AAtB6B,OAkB/BF,EAlB+B,CAyB/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAC,MAAAA,aAAa,GAAG,MAAM,CAAN,IAAA,CAAA,wBAAA,EAAA,GAAA,CACT,UAAA,KAAA,EAAK;AAAA,eAAA,GAAA,MAAA,CAAA,KAAA,EAAA,KAAA,EAAA,MAAA,CAAkBC,wBAAwB,CAAxBA,KAAwB,CAAxBA,CAAAA,IAAAA,CAAlB,GAAkBA,CAAlB,EAAA,GAAA,CAAA;AADI,OAAA,EAAA,IAAA,CAAhBD,MAAgB,CAAhBA;AAIA,aAAA,aAAA;AACD;;;;;;;;;;;;AAGOK,gBAAAA,M,GAAS,KAAA,oBAAA,CAATA,MAAAA;AACAC,gBAAAA,S,GAAY,KAAA,oBAAA,CAAZA,SAAAA;iDACC,KAAA,eAAA,CAAA,WAAA,CAAA,SAAA,EAAA,SAAA,GAAA,MAAA,CAGG;AACNC,kBAAAA,CAAC,EAAEF,MAAM,CAANA,KAAAA,KAAAA,EAAAA,GAAAA,GAAAA,GAA4BA,MAAM,CAD/B,KAAA;AAENG,kBAAAA,WAAW,EAAA,GAAA,MAAA,CAAKH,MAAM,CAAX,SAAA,EAAA,GAAA,EAAA,MAAA,CAAyBA,MAAM,CAFpC,UAEK,CAFL;AAGNI,kBAAAA,QAAQ,EAAE,KAAA,cAAA,CAAA,IAAA,CAHJ,GAGI,CAHJ;AAINC,kBAAAA,QAAQ,EAAE,CAACL,MAAM,CAAP,MAAA,EAAA,IAAA,GAAA,IAAA,CAJJ,GAII,CAJJ;AAKNM,kBAAAA,SAAS,EAAE,KAAA,kBAAA,CAAwBN,MAAM,CALnC,YAKK,CALL;AAMNO,kBAAAA,gBAAgB,EAAEP,MAAM,CANlB,iBAAA;AAONQ,kBAAAA,IAAI,EAAER,MAAM,CAANA,IAAAA,GAAc;AAPd,iBAHH,C","sourcesContent":["\"use strict\";\n\nexport class FacetSearchRequestAdapter {\n  constructor(instantsearchRequest, typesenseClient, searchByFields) {\n    console.log(instantsearchRequest);\n    this.instantsearchRequest = instantsearchRequest;\n    this.typesenseClient = typesenseClient;\n    this.searchByFields = searchByFields;\n  }\n\n  _adaptFacetFilters(facetFilters) {\n    let adaptedResult = \"\";\n\n    if (!facetFilters) {\n      return adaptedResult;\n    }\n\n    const intermediateFacetFilters = {};\n\n    // Need to transform:\n    // faceFilters = [[\"facet1:value1\", \"facet1:value2\"], \"facet2:value3\"]]\n    //\n    // Into this:\n    // intermediateFacetFilters = {\n    //     \"facet1\": [\"value1\", \"value2\"],\n    //     \"facet2\": [\"value1\", \"value2\"]\n    // }\n\n    facetFilters.flat().forEach(facetFilter => {\n      const [facetName, facetValue] = facetFilter.split(\":\");\n      intermediateFacetFilters[facetName] =\n        intermediateFacetFilters[facetName] || [];\n      intermediateFacetFilters[facetName].push(facetValue);\n    });\n\n    // Need to transform this:\n    // intermediateFacetFilters = {\n    //     \"facet1\": [\"value1\", \"value2\"],\n    //     \"facet2\": [\"value1\", \"value2\"]\n    // }\n    //\n    // Into this:\n    // facet1: [value1,value2] && facet2: [value1,value2]\n\n    adaptedResult = Object.keys(intermediateFacetFilters)\n      .map(facet => `${facet}: [${intermediateFacetFilters[facet].join(\",\")}]`)\n      .join(\" && \");\n\n    return adaptedResult;\n  }\n\n  async request() {\n    const params = this.instantsearchRequest.params;\n    const indexName = this.instantsearchRequest.indexName;\n    return this.typesenseClient\n      .collections(indexName)\n      .documents()\n      .search({\n        q: params.query === \"\" ? \"*\" : params.query,\n        facet_query: `${params.facetName}:${params.facetQuery}`,\n        query_by: this.searchByFields.join(\",\"),\n        facet_by: [params.facets].flat().join(\",\"),\n        filter_by: this._adaptFacetFilters(params.facetFilters),\n        max_facet_values: params.maxValuesPerFacet,\n        page: params.page + 1\n      });\n  }\n}\n"],"file":"FacetSearchRequestAdapter.js"}