{"version":3,"sources":["RequestAdapter.js"],"names":["_interopRequireDefault","require","Object","value","exports","_regenerator","_asyncToGenerator2","_slicedToArray2","_classCallCheck2","_createClass2","RequestAdapter","key","adaptedResult","intermediateFacetFilters","facetFilters","_facetFilter$split","facetFilter","_facetFilter$split2","facetName","facetValue","_request","_context","q","query_by","facet_by","filter_by","max_facet_values","page"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RequestAdapter = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar RequestAdapter =\n/*#__PURE__*/\nfunction () {\n  function RequestAdapter(instantsearchRequest, typesenseClient, searchByFields) {\n    (0, _classCallCheck2[\"default\"])(this, RequestAdapter);\n    this.instantsearchRequest = instantsearchRequest;\n    this.typesenseClient = typesenseClient;\n    this.searchByFields = searchByFields;\n  }\n\n  (0, _createClass2[\"default\"])(RequestAdapter, [{\n    key: \"_adaptFacetFilters\",\n    value: function _adaptFacetFilters(facetFilters) {\n      var adaptedResult = \"\";\n\n      if (!facetFilters) {\n        return adaptedResult;\n      }\n\n      var intermediateFacetFilters = {}; // Need to transform:\n      // faceFilters = [[\"facet1:value1\", \"facet1:value2\"], \"facet2:value3\"]]\n      //\n      // Into this:\n      // intermediateFacetFilters = {\n      //     \"facet1\": [\"value1\", \"value2\"],\n      //     \"facet2\": [\"value1\", \"value2\"]\n      // }\n\n      facetFilters.flat().forEach(function (facetFilter) {\n        var _facetFilter$split = facetFilter.split(\":\"),\n            _facetFilter$split2 = (0, _slicedToArray2[\"default\"])(_facetFilter$split, 2),\n            facetName = _facetFilter$split2[0],\n            facetValue = _facetFilter$split2[1];\n\n        intermediateFacetFilters[facetName] = intermediateFacetFilters[facetName] || [];\n        intermediateFacetFilters[facetName].push(facetValue);\n      }); // Need to transform this:\n      // intermediateFacetFilters = {\n      //     \"facet1\": [\"value1\", \"value2\"],\n      //     \"facet2\": [\"value1\", \"value2\"]\n      // }\n      //\n      // Into this:\n      // facet1: [value1,value2] && facet2: [value1,value2]\n\n      adaptedResult = Object.keys(intermediateFacetFilters).map(function (facet) {\n        return \"\".concat(facet, \": [\").concat(intermediateFacetFilters[facet].join(\",\"), \"]\");\n      }).join(\" && \");\n      return adaptedResult;\n    }\n  }, {\n    key: \"request\",\n    value: function () {\n      var _request = (0, _asyncToGenerator2[\"default\"])(\n      /*#__PURE__*/\n      _regenerator[\"default\"].mark(function _callee() {\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                return _context.abrupt(\"return\", this.typesenseClient.collections(this.instantsearchRequest.indexName).documents().search({\n                  q: this.instantsearchRequest.params.query === \"\" ? \"*\" : this.instantsearchRequest.params.query,\n                  query_by: this.searchByFields.join(\",\"),\n                  facet_by: [this.instantsearchRequest.params.facets].flat().join(\",\"),\n                  filter_by: this._adaptFacetFilters(this.instantsearchRequest.params.facetFilters),\n                  max_facet_values: this.instantsearchRequest.params.maxValuesPerFacet,\n                  page: this.instantsearchRequest.params.page + 1\n                }));\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function request() {\n        return _request.apply(this, arguments);\n      }\n\n      return request;\n    }()\n  }]);\n  return RequestAdapter;\n}();\n\nexports.RequestAdapter = RequestAdapter;"],"file":"RequestAdapter.js"}